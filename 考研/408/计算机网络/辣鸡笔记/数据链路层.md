# 数据链路层

向**网络层**提供服务，加强**物理层**传输原始比特流的功能，改造成逻辑上没有差错的**数据链路**

## 功能

1. 为网络层提供服务

   - 无确认的无连接服务

     适用于实时通信以及误码率较低的通信服务

   - 有确认的无连接服务

     适用于误码率较高的通信服务

   - 有确认的面向连接服务

     需要建立连接并对收到的每一帧都需要给出确认

2. 链路管理

   数据链路层连接的**建立**、**维持**和**释放**过程称为链路管理

3. 组帧

4. 流量控制

   限制发送方数据流量，使其不超过接收方接受能力

5. 差错控制

   错误分为**位错**和**帧错**

   位错：使用**循环冗余校验**（$CRC$）发现位错

   帧错：引入**定时器**和**编号机制**保证每帧有且仅有一次正确交付


## 组帧

组帧：通过给数据加上首部以及尾部给帧定界，也就是告知接收方帧的起始以及结束

透明传输：无论比特组合都可以传输，链路层的透明传输需要采取手段防止**比特组合**与**控制信息**相同

1. 字符计数法

   在数据的开头加上一个数字表示帧的长度

   开头的数字一旦被污染将对整个数据报产生影响

2. 字符填充的首位定界符法

   在首尾分别加上定界符并通过转义字符在数据部分将定界符与普通数据区分

3. 零比特填充的首尾标志法

   $5110$方法：使用$01111110$表示定界，数据部分中如果遇到$5$个连续的$1$就插入一个$0$

4. 违规编码法

   使用一个不合法的编码来标志首尾定界符，例如曼彻斯特编码中的“高-高”电平

## 差错控制

只能控制**位错**

### 噪声来源

1. 全局性噪声：线路本身的电气特性带来的随机噪声
2. 局部性噪声：外界短暂原因带来的冲击噪声

### 检错编码

$编码\begin{cases}物理层：单个比特\\数据链路层：一组比特是否出错\end{cases}$

1. 奇偶校验码

   由$n-1$位信息源以及$1$位校验元组成

   通过调整校验元的正负，奇校验码要求$n$个位中一共要有奇数个$1$，偶校验码要求$n$个位中一共要有偶数个$1$

   只有$50\%$的可能性检查出错误

2. 循环冗余码（$CRC$）

   1. 接收发送双发商定一个长度为$r$的多项式$G(x)$
   2. 在帧的低位加上$r-1$个$0$
   3. 模$2$除法，使用异或方法计算后$r-1$位
   4. 将得到的余数也就是帧检验序列（$FCS$）替代帧的后$r-1$位

### 纠错编码

主要使用**海明码**纠错

作用：发现双比特错误，纠正单比特错误

假设我们有一个$011011$的串需要使用海明码校验，以下是海明码的形成过程以及最后如何校验

1. 确定海明码位数

   我们假设原串长度为$n$，需要的海明码长度为$k$，那么我们就能得到**海明不等式**：
   $$
   n+k\leq 2^k-1
   $$
   通过计算式子中的$k$就能得到需要的海明码数量

2. 确定校验位分布

   假设我们需要$k$位海明码，分别标号为$P_1\ldots P_k$

   那么的话我们得到$P_i$的位置规律为$P_i=2^{i-1}$，剩下的位置按序填入串

   |            | $1(0001)$ | $2(0010)$ | $3(0011)$ | $4(0100)$ | $5(0101)$ | $6(0110)$ | $7(0111)$ | $8(1000)$ | $9(1001)$ | $10(1010)$ |
   | ---------- | --------- | --------- | --------- | --------- | --------- | --------- | --------- | --------- | --------- | ---------- |
   | 当前位意义 | $P_1$     | $P_2$     | $D_1$     | $P_3$     | $D_2$     | $D_3$     | $D_4$     | $P_4$     | $D_5$     | $D_6$      |
   | 具体数值   |           |           | $0$       |           | $1$       | $1$       | $0$       |           | $1$       | $1$        |

3. 分组形成校验关系

   我们现在需要计算$k$位海明码，计算方式就是将第$i$位为$1$的位数上面的数字异或起来得到$P_i$
   $$
   \begin{align}
   P_1&=D_1\oplus D_2\oplus D_4\oplus D_5\\
   P_2&=D_1\oplus D_3\oplus D_4\oplus D_6\\
   P_3&=D_2\oplus D_3\oplus D_4\\
   P_4&=D_5\oplus D_6
   \end{align}
   $$

4. 校验位取值

   根据上面的关系我们能得到串如下

   |            | $1(0001)$            | $2(0010)$            | $3(0011)$ | $4(0100)$            | $5(0101)$ | $6(0110)$ | $7(0111)$ | $8(1000)$            | $9(1001)$ | $10(1010)$ |
   | ---------- | -------------------- | -------------------- | --------- | -------------------- | --------- | --------- | --------- | -------------------- | --------- | ---------- |
   | 当前位意义 | $P_1$                | $P_2$                | $D_1$     | $P_3$                | $D_2$     | $D_3$     | $D_4$     | $P_4$                | $D_5$     | $D_6$      |
   | 具体数值   | $\textcolor{red}{0}$ | $\textcolor{red}{0}$ | $0$       | $\textcolor{red}{0}$ | $1$       | $1$       | $0$       | $\textcolor{red}{0}$ | $1$       | $1$        |

   其中红色的就是通过校验关系计算得到

5. 校验原理

   一位错误：接收方接收到串之后将所有第$i$位是$1$的位数异或得到$k$个数字并分别与最终答案（初始化为$0$）的第$i$位异或，如果最终答案为$0$那么就代表当前串没有错误，如果最终答案非$0$就代表指定位数错误

   假设接收到的串如下

   |            | $1(0001)$ | $2(0010)$ | $3(0011)$ | $4(0100)$ | $5(0101)$ | $6(0110)$          | $7(0111)$ | $8(1000)$ | $9(1001)$ | $10(1010)$ |
   | ---------- | --------- | --------- | --------- | --------- | --------- | ------------------ | --------- | --------- | --------- | ---------- |
   | 当前位意义 | $P_1$     | $P_2$     | $D_1$     | $P_3$     | $D_2$     | $D_3$              | $D_4$     | $P_4$     | $D_5$     | $D_6$      |
   | 具体数值   | ${0}$     | ${0}$     | $0$       | ${0}$     | $1$       | $\textcolor{red}0$ | $0$       | ${0}$     | $1$       | $1$        |

   $$
   \begin{align}
   S_1&=D_1\oplus D_2\oplus D_4\oplus D_5\oplus P_1=0\\
   S_2&=D_1\oplus D_3\oplus D_4\oplus D_6\oplus P_2=1\\
   S_3&=D_2\oplus D_3\oplus D_4\oplus P_3=1\\
   S_4&=D_5\oplus D_6\oplus P_4=0
   \end{align}
   $$

   所以我们就能知道错误的位是$0110$
   
   > 纠正$d\ bit$的错误需要海明距$2d+1$

## 流量控制与可靠传输

### 流量控制

较高的发送速度与较低的接受能力的不匹配

常见的方法分为**停止-等待协议**与**滑动窗口协议**

其中滑动窗口协议又可以分为**后退$N$帧协议**（$GBN$）以及**选择重传协议**（$SR$）

#### 链路层与传输层辨别

链路层：点到点，接收不了就不回复确认

传输层：端到端，给发送端一个窗口公告

### 停止-等待协议

发送方每发送一帧，接收方都要回复，只有发送方接收到了接收方的回复才能回复下一帧

#### 错误控制

1. 数据帧丢失：超时重传，时间设置略大于$RTT$
2. $ACK$丢失：超时重传
3. $ACK$迟到：超时重传，丢弃迟到帧

#### 存在问题

只要没有回复就一直要等着，信道利用率过低

> 信道利用率：发送方在一个发送周期内有效发送数据占整个发送周期比率
>
> 信道吞吐率：信道利用率$*$发送方发送速率
> $$
> U=\frac{T_D}{T_D+RTT+T_A}
> $$
> 其中$T_D$代表发送时间，$T_A$表示接收时间

### 后退$N$帧协议（$GBN$）

鉴于发送一帧之后一直要等待的问题，$GBN$作出调整，扩大发送窗口，可以一次发送多个帧，等待接收方接收之后返回的确认帧

$GBN$采用**累计确认**的方式，即如果接收到$n$号帧的确认帧，代表$1\sim n$号帧都以及得到接收

#### 响应事件

1. 上层调用

   网络层调用数据链路层功能发送数据报，如果窗口未满则加入窗口中然后发送；如果窗口已满则加入缓存中或者将数据报退回网络层

2. 收到$ACK$

   累计确定，已经收到了所有之前的确认帧

3. 超时事件

   超时重传所有已发送未确认帧

#### 存在问题

将窗口内的数据分别编号为$1\sim n$，如果一次性将$n$个数据全部发出，但$1$号数据超时重传，那么的话窗口内的所有数据都将重传，这样的话就会导致效率的降低

### 选择重传协议（$SR$）

$GBN$的效率降低主要问题在于其不能对特定的帧作出反应，而$SR$选择扩大接收窗口可以接收，并对特定的已经接收的报文选择发送确认报文

#### 响应事件

1. 上层调用

   网络层调用数据链路层功能发送数据报，如果窗口未满则加入窗口中然后发送；如果窗口已满则加入缓存中或者将数据报退回网络层

2. 收到$ACK$

   滑动窗口移动至最小序号未被发送帧

3. 超时事件

   超时引发重传事件，重传特定帧

### 可靠传输

通过**确认**和**超时重传**两种机制完成

$ARQ$：自动重传请求，分为**停止-等待$ARQ$**，**后退$N$帧$ARQ$**，**选择性重传$ARQ$**

### 总结

三者分别相互区别但又有联系，停止-等待协议是最基本的传输协议，但因为传输效率低引入了后退$N$帧协议，通过扩大发送窗口一次性发送多条数据来提升信道利用率，但如果遇到可靠性较低的信道会导致反复重传降低效率，所以又引入选择重传协议，通过扩大接收窗口精确传送确认报文

三者都可以认为是滑动窗口协议，不同的是窗口的大小

停止等待协议：$size_{send}=1,size_{accept}=1$

后退$N$帧协议：$size_{send}>1,size_{accept}=1$

选择重传协议：$size_{send}>1,size_{accept}>1$

假设采用$n\ bit$的帧序号，那么为了防止接收方混淆编号$W_{send}+W_{accept}\leq2^n$

所以在$GBN$中因为$W_{accept}=1$那么的话$W_{send}\leq 2^n-1$

在$SR$中为了$W_{send}=W_{accept}$来保证效率最大化，$W_{send}=W_{accept}=2^{n-1}$

## 介质访问控制

在**广播式网络**中各主机共用一个信道，所以为了解决主机与主机之间发送信号的冲突就要引入**介质访问控制**

介质访问控制方法：**信道划分介质访问控制**（静态划分信道）、**随机访问介质访问控制**（动态分配信道）、**轮训访问介质访问控制**（动态分配信道）

### 信道划分介质访问控制

通过**多路复用技术**将多个信号组合在一条物理信道上进行传输，使多个主机共享信道资源。实质上就是在逻辑上将信道划分成多个子信道将**广播信道**转变为**点对点**信道。

1. 频分多路复用（$FDM$）

   将不同的信号调制到不同**频率**的载波上

2. 时分多路复用（$TDM$）

   将一个周期划分成多个**时间段**，轮流分配给每个主机用

   $STDM$：不固定分配时间段而是通过统一调配按需动态分配

3. 波分多路复用（$WDM$）

   **光**的频分多路复用

4. 码分多路复用

   假设存在两个信号发送站$A$与$B$，其中$S$代表$A$发送的**码片**向量，$T$代表$B$的码片向量。

   >码片：将一个单位的比特时间分成$m$个时间槽，每个站点唯一指定一个码片。发送$1$的时候发送这个站点的码片，发送$0$的时候发送这个站点码片的反码

   要求每个码片和自己的规格化内积为$1$，每个码片和自己的反码的规格化内积为$-1$，不同信号发送站的码片相乘就是$0$。
   $$
   \begin{align}
   \frac{1}{m}S·S&=1\\
   \frac{1}{m}S·(-S)&=-1\\
   S·T&=0\\
   \end{align}
   $$
   那么的话如果在信道上多个信号复合就是码片按位相加。
   $$
   sum=S+T
   $$
   达到终点之后如果想要知道$A$站的信号只要将得到的信号与$A$站的码片规格话内积就能够得到。
   $$
   \frac{1}{m}sum·S=\frac{1}{m}(S+T)·S=1
   $$

### 随机访问介质访问控制

用户根据自己的意愿随机发送信息

1. $ALOHA$协议

   1. 纯$ALOHA$协议

      **发送方式**：任何一个主机想要发送信息都可以直接发送

      **确认方式**：如果在一段时间内没有收到确认，那么就认为出现冲突需要等待一段时间

   2. 时隙$ALOHA$协议

      因为发送的随意性导致了信道利用率的低下，因此要限制发送的随意性

      **限制方式**：将时间划分成等长的时隙只有在每个时隙开始的时候才能发送一个帧

2. $CSMA$协议

   $CS$：监听信道 $MA$：多点接入连接总线

   1. $1-$坚持$CSMA$

      监听信道，确认信道是否繁忙，如果忙**等待**；信道如果空闲**立即**发数据；发生冲突后随机等待一段时间再监听信道

      优点：提升媒体利用率

      缺点：多监听引发冲突

   2. 非坚持$CSMA$

      监听信道，确认信道是否繁忙，如果忙**放弃**监听，等待一个随机时间继续监听；信道如果空闲**立即**发数据

      优点：随机重发时间减少冲突

      缺点：线路上多个主机等待降低使用率

   3. $p-$坚持$CSMA$

      使用场景：时分信道

      监听信道，确认信道是否繁忙，如果忙等待；信道如果空闲$p$的概率继续立即发送数据，$1-p$的概率等待下一个时隙

      优点：既减少冲突又提高使用率

      缺点：冲突后还发送

3. $CSMA/CD$协议

   $CD$：碰撞检测，边发送边监听

   在站点**发送前**和**发送中**都不断检测信道

   > 全双工通信中双方必然产生冲突因此$CSMA/CD$协议只能用于半双工通信

   $碰撞检测反应时间_{max}=2\tau$

   为了能够及时检测碰撞，防止在检测到碰撞之前检测到碰撞引入最短帧长
   $$
   最小帧长=2\tau * 数据传输速率
   $$
   碰撞恢复问题：采用**截断二进制指数退避算法**

   > 截断二进制指数退避算法
   >
   > 1. 确定基本退避时间，一半采用$2\tau$
   > 2. 定义参数$k\in[1, 10]$，取重传次数和$10$的最小值
   > 3. 从$[0,1,\ldots,2^k-1]$中取出一个数$r$乘上基本退避时间得到等待时间
   > 4. 重传$16$次失败说明网络过于拥挤，向高层报告出错

4. $CSMA/CA$协议

   适用于无线局域网的$CSMA/CD$协议升级版

   因为**范围大**（无线介质信号强度变化大，无法低成本检测碰撞）以及**“隐蔽站”**的问题导致$CSMA/CD$协议在**无线局域网**上无法使用

   使用$RTS$和$CTS$处理**“隐蔽站”**的问题

   > 先广播一个$RTS$控制帧向目的基站请求连接，如果合适的话返回一个$CTS$帧表示确认以及被预约

   考虑到无线通信质量低，需要使用链路层**确认/重传**方案，即每接收到一个帧都要发送一个$ACK$帧确认
   
   帧间间隔（$IFS$）：为了避免碰撞所有站发送完成后被必须等待的一段时间，这个时间由即将发送的帧确定
   
   > $SIFS$：最短的$IFS$，主要用于$ACK$帧，$CTS$帧，分片以后的数据帧以及所有回答$AP$探寻的帧
   >
   > $PIFS$：中等长度的$IFS$，在$PCF$中使用
   >
   > $DIFS$：最长的$IFS$，用于异步帧竞争访问的时延，主要用于$RTS$帧
   
   - $CSMA/CA$协议与$CSMA/CD$协议比较
     1. 传输介质上，$CSMA/CD$用于**总线型以太网**，$CSMA/CA$用于**无线局域网**
     2. 检测方式上，$CSMA/CD$通过**电压变化检测**，$CSMA/CA$采用**能量检测**、**载波检测**和**能量载波混合检测**

## 轮询访问：令牌传递协议

### 信道划分介质访问控制协议与随机访问$MAC$协议比较

- 信道划分介质访问控制协议

  负载重：效率高，公平

  负载轻：效率低

- 随机访问$MAC$协议

  负载重：产生冲突开销

  负载低：效率高，可以独占

比较两者之后发现两者各有不足，因此提出轮询访问控制来优化

### 轮询协议

主节点轮流“邀请”从属节点发送数据

1. 轮询开销
2. 等待延迟
3. 单点故障

### 令牌传递协议

令牌在主机之间传递，拥有令牌的主机可以在拥有令牌期间发送数据

1. 令牌开销
2. 等待延迟
3. 单点故障

## 局域网

### 局域网基本概念以及体系结构

在一个**较小**的地理范围内将各单位通过连接介质连接起来形成的一个资源和信息共享的**计算机互联网络**。

1. 覆盖范围小
2. 专用的传输介质
3. 通信时延短，误码率低，可靠性高
4. 各站平等，共享信道
5. 多采用分布式控制和广播式通信

特性决定要素：**拓扑结构**、**传输介质**以及**介质访问控制方式**

#### 拓扑结构

分为四大类：**星形结构**，**环形结构**，**总线型结构**以及**树形结构**

三种特殊的网络拓扑结构：

- 以太网

  逻辑拓扑**总线型**，物理拓扑**星型**或者拓展星型

- 令牌环

  逻辑拓扑环型，物理拓扑星型

- $FDDI$

  逻辑拓扑环型，物理拓扑双环型

#### 传输介质

双绞线，铜缆和光纤灯多种传输介质

#### 介质访问控制

总线型局域网：$CSMA/CD$，令牌总线

> 令牌总线将总线型网络中各个工作站按序号排成逻辑环

环形局域网：环形局域网

#### 局域网链路层体系结构拆解

分为**逻辑链路控制**（$LLC$）以及**媒体接入控制**（$MAC$）

##### 逻辑链路控制（$LLC$）

向**网络层**提供服务，包括无确认无连接、面向连接、带确认无连接以及高速传送四种连接服务类型

##### 媒体接入控制（$MAC$）

提供对于**物理层**的接口，主要功能包括：组帧和拆卸帧、比特传输差错检测、透明传输

#### $IEEE\ 802$标准

在**$80$年$2$月**制定的关于**局域网**参考模型

**重点记忆**：
$$
\begin{cases}
IEEE\ 802.3\ 以太网\\\\
IEEE\ 802.5\ 令牌环网\\\\
IEEE\ 802.8\ 光纤\\\\
IEEE\ 802.11\ WLAN\\
\end{cases}
$$

### 以太网与$IEEE\ 802.3$

局域网最通用的通信协议标准，描述了一种**基带总线型**的局域网标准，描述了**物理层**以及**数据链路层$MAC$子层**的实现方式。使用$CSMA/CD$协议

1. 造价低廉
2. 应用最广泛的局域网技术
3. 比$ATM$网，令牌环网简单
4. 满足$10Mb/s\sim 1Gb/s$的传输速度

以太网标准：主要符合$DIX\ Ethernet\ V2$标准，但$IEEE\ 802.3$标准与之差距较小，因此也称为**以太网**

#### 以太网传输介质

| 参数         | $10BASE5$    | $10BASE2$    | $\textcolor{red}{10BASE-T}$     | $10BASE-FL$  |
| ------------ | ------------ | ------------ | ------------------------------- | ------------ |
| 传输媒体     | 基带同轴电缆 | 基带同轴电缆 | $\textcolor{red}{非屏蔽双绞线}$ | 光纤         |
| 编码         | 曼彻斯特编码 | 曼彻斯特编码 | $\textcolor{red}{曼彻斯特编码}$ | 曼彻斯特编码 |
| 拓扑结构     | 总线型       | 总线型       | $\textcolor{red}{星型}$         | 点对点       |
| 最大段长     | $500m$       | $185m$       | $\textcolor{red}{100m}$         | $2000m$      |
| 最多节点数量 | $100$        | $30$         | $\textcolor{red}{2}$            | $2$          |

#### 网卡与$MAC$地址

计算机与外界联系通过**网卡**实现，网卡上装有处理器和存储器。

全世界每块网卡有一个唯一代码称为$MAC$地址

#### 以太网$MAC$帧

$MAC$地址长$6Byte$，共$48bit$，常用$12$个十六进制数表示

- $MAC$帧格式（以太网$V2$）

  前导码：长度$8B$，前面$7B$为前同步码，用于实现比特同步，后$1B$为帧定界符，这个部分不认为是帧的部分

  目的地址、源地址：长度$6Byte$

  类型：长度$2Byte$

  数据部分：长度$46\sim 1500Byte$，$46Byte$是通过以太网最小长度$64Byte$减去其余部分后得到，$1500Byte$由以太网$MTU$规定

  填充：填充无用数据保证帧长度最小为$64Byte$

  校验码：长度$4Byte$，采用$32$位循环冗余码检验出了前导码之外所有的部分

#### 高速以太网

速率超过$100Mb/s$的称为**高速以太网**

1. $100BASE-T$以太网

   速率：$100Mb/s$

   介质：双绞线

   通信方式：全双工$+$半双工（不使用$CSMA/CD$）

2. 吉比特以太网

   速率：$1Gb/s$

   介质：双绞线或光纤

   通信方式：全双工$+$半双工（不使用$CSMA/CD$）

3. $10$吉比特以太网

   速率：$10Gb/s$

   介质：光纤

   通信方式：半双工（不使用$CSMA/CD$）

### 无线局域网与$IEEE\ 802.11$

#### 无线局域网组成

- 有固定基础设施无线局域网

  使用**星型拓扑**结构，以**接入点**$AP$为中心以及众多主机为被接入点构成了无线局域网的**最小构建**——**基本服务集$BSS$**。不同的基本服务集之间可以通过**分配系统$DS$**相互连接形成一个**拓展的服务集$ESS$**

- 无固定基础设移动自组织网络

  网络内部所有主机处于平等状态，每个主机都能够自由发送消息也可以作为中间节点转发消息

#### $802.11$的$MAC$帧

| 功能       | $To\ DS$ | $From\ DS$ | $Address\ 1$ | $Address\ 2$ | $Address\ 3$ | $Addres\ 4$ |
| ---------- | -------- | ---------- | ------------ | ------------ | ------------ | ----------- |
| $IBSS$     | $0$      | $0$        | $DA$         | $SA$         | $BSSID$      | 未使用      |
| $To\ AP$   | $1$      | $0$        | $BSSID$      | $SA$         | $DA$         | 未使用      |
| $From\ AP$ | $0$      | $1$        | $DA$         | $BSSID$      | $SA$         | 未使用      |
| $WDS$      | $1$      | $1$        | $RA$         | $TA$         | $DA$         | $SA$        |

> $IBSS$：一个服务集内两个移动站点之间通信
>
> $To\ AP$：服务集内移动站点向基站通信
>
> $From\ AP$：服务集内基站向移动站点通信
>
> $WDS$：不同服务集内两个移动站点之间通信
>
> $DA$：目的地址
>
> $SA$：源地址
>
> $BSSID$：基站地址
>
> $RA$：接收端，可以是基站地址也可以是主机地址
>
> $TA$：发送端，可以是基站地址也可以是主机地址

可以认为$Address\ 1$与$Address\ 2$分别代表**接受地址**以及**发送地址**，同时考虑到帧的源地址、目的地址以及当前所在基站不可或缺我们使用$Address\ 3$以及$Address\ 4$两个地址对前面的地址进行补充

如果两个移动主机要跨基站交流，那么的话就要先使用$To\ AP$类型帧发送给基站然后使用多个$WDS$类型帧将数据内容传递到目的主机所在基站，最后使用$From\ AP$类型帧交付给目的主机

### $VLAN$

一个以太网可以认为是一个**广播域**

> 冲突域：同一个冲突域内的主机不能同时发送信息，否则发送信道冲突
>
> 广播域：同一个广播域内的主机能够无视交换机发送广播
>
> 冲突域因为交换机的隔离导致范围小于广播域，而广播域的隔离需要路由器才能够进行

然而我们能够通过$VLAN$在数据链路层上划分**广播域**减少广播帧的出现以防止广播风暴的出现

$VLAN$帧在$MAC$的帧的基础上在目的地址以及源地址的后面加上$VLAN$标签形成长度$4Byte$，前$2Byte$表示$VLAN$帧的类型后$2Byte$中前$4bit$无意义，后$12bit$代表$VLAN$编号$VID$

主机并不知道自己的$VLAN$地址，但交换机一定知道。主机发送$MAC$帧交给交换机之后交换机加上$VLAN$标签并转发

## 广域网

广域网指覆盖范围很广（远超一个城市的范围）的长距离网络，通过分组交换将不同局域网或计算机系统互联来达到资源共享的目的

|                   | 广域网                     | 局域网             |
| ----------------- | -------------------------- | ------------------ |
| 覆盖范围          | 跨区域                     | 一个区域           |
| 连接方式          | 点到点连接                 | 多点接入技术       |
| $OSI$参考模型层次 | 物理层，数据链路层，网络层 | 物理层，数据链路层 |
| 着重点            | 强调资源共享               | 强调数据传输       |

广域网和局域网从互联网角度上看平等不是包含关系

常用的广域网数据链路层协议分为**$PPP$协议**以及**$HDLC$协议**

### $PPP$协议

使用**串型线路通信**的**面向字节**的协议，应用在直接**连接两个节点的链路**上

有三个组成部分：

1. 链路控制协议（$LCP$），物理连接，组织数据链路的事宜
2. 网络控制协议（$NCP$），逻辑连接，不同的网络层协议都要响应的$NCP$配置
3. 将$IP$数据报封装到串型链路的方法

$PPP$帧内容格式：

1. 标志字段，首尾各一个，内容为$7E$
2. 地址字段，并不起作用，内容为$FF$
3. 控制字段，内容为$03$
4. 协议字段，表示信息字段使用了什么协议
5. 信息字段，使用转义字符$7D$来对$7E$进行转义
6. $FCS$，检测字段，长度$2B$

在**异步线路**上使用**字符填充法**，在**同步线路**上使用**比特填充**（$5110$）

### $HDLC$协议

面向**比特**的**数据链路层**协议

1. 透明传输
2. 全双工通信
3. $CRC$检验

#### 主站、从站、复合站以及引申的响应方式

主站：控制从站发送信息

从站：被控制发送信息

复合站：既能够控制从站发送信息又能自己发送信息

****

正常响应方式：主站命令从站发送信息

异步响应方式：从站自己发送信息

异步平衡方式：从站主站都能发送信息

#### $HDLC$帧格式

1. 标志$F$，首尾都有，内容$7F$

2. 地址，**正常响应方式以及异步响应方式**的情况下表示**从站地址**，**异步平衡方式**表示**应答站地址**

3. 控制字段，表示帧的功能

   - 信息帧（起始为$0$）

     传输数据信息

   - 无编号帧（起始为$11$）

     建立链路

   - 监督帧（起始为$10$）

     进行流量控制以及差错控制

#### $HDLC$协议与$PPP$协议对比

1. $PPP$协议面向字节，$HDLC$协议面向比特
2. $HDLC$帧多$2B$的协议字段
3. $PPP$协议不使用序号和确认机制，$HDLC$协议使用

## 数据链路层设备

### 网桥

将多个以太网连接之后将形成一个更大的以太网，原来的每个以太网就被称为**网段**

网桥工作在链路层的$MAC$子层，使得以太网各网段成为隔离开的**冲突域**

### 交换机

可以认为是一个**多端口网桥**，起的作用与网桥类似但端口更多，在**全双工方式**下工作

#### 交换机的自学习功能

交换机中需要维护一张交换表来保证信息的正常转发，而这张交换表的维护就要交给**自学习功能**

假设从$A$向$B$发送信息

$k$端口收到$A$发来的帧那么的交换机就会将$A$与端口对应起来并记录在表中，如果$B$被记录在交换表中，那就指定交换口发送，如果没有的话就进行广播直到找到$B$

考虑到主机的连接变化，每个表都要设定一个有效时间，过期的需要删除
