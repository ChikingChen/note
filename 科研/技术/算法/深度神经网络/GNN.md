# [GNN](https://distill.pub/2021/gnn-intro/#graph-to-tensor)

使用一个张量来描述图的一个点，多个张量合并为一个形状为$[n_{node},node_{dim}]$的矩阵。用同样的方式我们也能描述图中的边。

## 最简单的GNN

使用深度神经网络来训练GNN，将点向量、边向量以及全图向量放入目标网络进行训练。训练的输出结果相较于输入结果在结构上没有变化，包括向量的维度、向量的种类以及向量的数量等等。

通过对每个结点使用线性分类器来完成结点的二分类任务。一些情况下，可能会出现只有边的信息，但我们要预测结点的信息。我们能够通过池化来完成这个过程。

- 如何完成池化？

  将与点相关的边聚集起来并加和成一个合向量作为点向量

## 信息传递

在消息传递机制中，我们通过GNN层内池化来做出更加复杂的预测，从而使得我们的组件能够了解图的连通性。消息传递机制种，相邻的结点和边将相互交换信息

消息传递机制的过程：将所有相邻的点组件（也就是信息）收集起来加和，将所有池化后的信息放入一个神经网络进行训练

相较于池化只能在结点和结点之间或者边和边之间应用，消息传递在结点和边之间应用

消息传递和卷积实际上比较像，都是为了将当前节点和相邻的结点联系起来

> 消息传递机制
>
> 将与结点相连的边的信息与结点的信息加和在一起进行池化
>
> 加起来的方式有三种：max sum mean

## 边表示

以上的通过池化将边的信息转化为点的信息，但这种操作只能用于模型最后一步的预测。但是消息传递过程中，点向量和边向量往往结构不同，需要使用函数将两者结构统一起来。

构建GNN的过程中我们能够选择更新什么图的属性以及以哪个顺序更新，我们可以选择节点组件和边组件哪者先更新。

更新方式实际上分为四种：节点到节点，边到边，结点到边，边到结点。将这四种结合构成**编织**的形式。

> GNN的池化操作
>
> 我们能够理解的是GNN所研究的图实际上是一个整体，这和CNN研究的图像实际上非常类似，当我们要研究一个结点的性质的时候不能只关注于这个结点，而应该关注与这个结点相连的边和结点，因为这个连接性实际上也能够反应结点的性质。这种操作在GNN中被称为消息传递，区别于普通的池化。我们能够理解的是普通的池化的目标是结构相同的向量，但是在消息传递中我们需要在结点向量和边向量之间进行池化操作，这就牵涉到边向量到结点向量的方程转化以及姐点向量到边向量的方程转化。

## 全局表示

如果我们构建了一个k层的网络，那么在上面这种方式中一个节点最多能够接受距离其k结点的影响，但是如果我们希望这个结点接受整个网络的信息，这样做就没有意义了。实际上面对一些比较小的网络的时候我们能够通过引入添加虚边的方式来解决这个问题，但面对一些较大的网络的时候我们就要引入一个代表全图的结点来解决。

这个全局结点能够连接图中所有的结点和所有的边，通过这个结点，我们能够表示整个图的属性。

## GNN的调试方式

- 参数越多，准确率越高
- 层数越多，准确率越高
- 总和池化方式准确率稍高一些
- 越多属性被纳入GNN，准确率越高

GNN的一个问题在于如何建图

## 特殊的图

hypergraph：一条边能够连接多个结点

## GNN划分训练集

不同的图数据量不同，我们不能使用相同数量的训练数据

大图划分可能会将其划分为小图，但小图有时候可能会有别的意义（大分子划分成小分子可能就别成了别的分子）

一种采样方式是，在一个图上随机采样一个点，而后在这个点向外扩展k个距离的子图，即为我们的训练用子图

有时候图特别大并且不可分，那么我们就要使用Cluster-GCN或者GraphSaint这样的技术

## 消息传递操作

平均操作：邻居结点方差较大，或者需要综合考虑周边结点

最大操作：突出最大的结点

加和操作：以上两者的折衷

## 双重图

边和结点实际上能够相互转化

## 图卷积的具体操作

邻接矩阵$A(n_{nodes}\times n_{nodes})$和结点特征矩阵$X(n_{nodes}\times node_{dim})$的乘积

我们可以$AX$乘积的结果定义为$B$
$$
B_{ij}=\sum A_{ik}X_{kj}
$$
我们可以理解的是邻接矩阵实际上为一个连接性矩阵，其指明了一张图的连通性，如果$ij$两个点相连通那么$A_{ij}$即为$1$，矩阵$A$和矩阵$X$两者相乘实际上即为池化操作。

实际上当我们在稀疏图上进行这个操作的时候我们可以通过邻接列表来完成这个操作

## 图注意网络

给相连的边分配一个权重，权重越高代表两个点之间关系越紧密，我们能够通过softmax之类的函数来保证归一化。

## 图的可解释性和属性

GNNExplainer将问题转化为提取对任务最重要最相关的子图