# 应用层

## 应用层模型

### $C/S$模型

有一个中心点称为**服务器**以及多个节点称为**客户机**

- 服务器
  1. 永久性提供服务
  2. 永久性$IP$
- 客户机
  1. 与服务器通信，接收服务器服务
  2. 间歇性接入网络
  3. 动态$IP$
  4. 不能直接与其他客户通信

### $P2P$模型

没有中心服务器，每个节点都同时具有下载、上传的功能，权利与义务大体对等

#### 优点

1. 可拓展性好
2. 网络健壮性强

#### 缺点

获取服务的同时还要提供服务因此占用较多内存，影响速度

## $DNS$

将便于记忆的**主机名**转换为对应的**$IP$地址**

### 域名层次

域名：任何连接到互联网的主机都有一个唯一的层次结构名称

域：名称空间中一个能够被划分的管理

我们将**域**分别划分形成**子域**，**子域**可以背划分成**子域的子域**，因而形成了顶级二级三级乃至多级的域，从而方便各种级别组织管理

### 域名服务器

1. 根域名服务器

   所有根域名服务器都知道所有顶级域名服务器的$IP$地址

2. 顶级域名服务器

   收到$DNS$查询请求之后有两种可能

   1. 当前服务器查询到需要的$IP$地址，直接返回
   2. 继续查找分支的授权域名服务器

3. 授权域名服务器

   每台**主机**都必须在授权域名服务器处登记，因而总能将其管辖的主机名转换为该主机的$IP$地址

### 本地域名服务器

可以理解的是上述三者已经构成了整个域名服务器的体系，但为了方便使用我们添加了**本地域名服务器**用于代理我们主机的$DNS$服务

一台主机发送$DNS$查询信息时，这个查询请求就是发送给本地域名服务器的

### 域名解析

1. 递归查询

   $A$问$B$，$B$问$C$，$C$问$D$

2. 迭代查询

   $A$问$B$，$A$问$C$，$A$问$D$

现实情况下两者结合，**主机**向本地域名服务器查询采用**递归查询**，**本地域名服务器**向根域名服务器查询使用**迭代查询**，我们可以理解为本地域名服务器代理了主机的域名查询服务

> 迭代查询前提：各级别服务器清楚被查询地址下一级别服务器的$IP$地址

为了减少$DNS$查询报文数量我们在$DNS$服务器中引入了**高速缓存**用于存放域名与$IP$的映射关系并定期清理

## $FTP$

互联网上应用最广泛的**文件传输协议**

采用$C/S$模式，使用$TCP$可靠传输服务

服务器进程由负责**接收**新请求的**主进程**以及负责**处理**单个请求的**从属进程**组成

### 控制连接与数据连接

控制连接：传请求，使用服务器端口号$21$

数据连接：传文件，使用端口由传输模式确定

#### 控制连接

建立在$21$号端口上的连接，用于传送控制信息（连接请求、传送请求），在整个绘画期间一直保持打开状态

#### 数据连接

在接收到文件传输请求就创建“数据连接”，在传送完毕之后就结束运行

数据连接分为**主动模式$PORT$**以及**被动模式$PASV$**

- 主动模式$PORT$
  1. 客户端随机开放一个端口并发送命令告诉服务端
  2. 服务端收到命令之后开放$20$号端口并建立连接
- 被动模式$PASV$
  1. 客户端要读取数据时候发送$PASV$命令到服务器
  2. 服务器随机开放一个端口并告知客户端
  3. 客户端连接开放端口

## 电子邮件

### 组成结构

用户代理：可以理解为发送接收电子邮件的界面，用于**发送**、**接收**、**撰写**、**显示**以及**邮件处理**（删除转发）的功能

邮件服务器：用于发送接收邮件，同时向发信人报告邮件传送情况。邮件服务器之间的通信方式为$C/S$方式，但两者必须既可以当主机也能够当服务器

邮件发送接收协议：**邮件发送协议**——用户代理向邮件服务器或邮件服务器之间发送邮件的协议；**邮件读取协议**——用户代理从邮件服务器读取邮件

通过**$TCP$连接**实现

### $SMTP$

控制两个相互通信的$SMTP$进程交换信息，使用$C/S$方式，$TCP$连接，端口号为$25$

$SMTP$客户：负责发送邮件的$SMTP$进程

$SMTP$服务器：负责接收邮件的$SMTP$进程

> 连接建立过程见《王道考研计算机网络》$P264$

然而考虑到$SMTP$只能传送$7bit\ Ascii$码同时由长度限制的问题因此引入了$MIME$来对$SMTP$功能进行拓展

### $POP3$与$IMAP$

使用$C/S$工作方式，在传输层使用$TCP$，端口号为$110$

$POP$分别由两种工作方式：“下载并保留”以及“下载并删除”，分别表示下载后保留在邮件服务器上以及下载后直接删除的工作方式

$IMAP$相较于$POP3$更加复杂但功能也更加多

1. $IMAP$能够实现不同计算机随时查询的功能
2. $IMAP$允许用户代理只获取报文的某些部分

现行的电子邮件一般在主机与服务器之间传输使用$HTTP$协议，而在服务器之间传输使用$SMTP$协议

## 万维网

通过$C/S$方式工作

### 概念

- 统一资源定位符（$URL$）

  表示万维网上的所有文档，每个文档在万维网上有唯一$URL$

  $URL$一般形式
  $$
  <协议>://<主机>:<端口>/<路径>
  $$

  > 协议：获取文档的协议
  >
  > 主机：资源所在主机的域名或者$IP$地址

- 超文本传输协议（$HTTP$）

  一个应用层协议，使用$TCP$实现可靠传输

- 超文本标记语言（$HTML$）

  文档结构的标记语言，使用特定的标记对页面上的信息进行描述

### $HTTP$

- 无状态

  $HTTP$不描述使用的用户，也就是说当一个人结束一个网页的使用之后再次打开这个网页将不留下任何痕迹

  为了解决这个问题引入了$Cookie$也就是通过唯一的标识码来标识使用的客户以此来达成个性化的定制

- 持久连接以及非持久连接

  - 持久连接

    对于每个网站元素对象的传送都要单独建立一个$TCP$连接

  - 非持久连接

    一个$TCP$连接被建立之后长久存在，再次使用的时候不需要再次建立

    非持久连接也分为**流水线方式**以及**非流水线方式**

    流水线方式：每遇到一个请求都立即发送请求

    非流水线方式：只有上一个请求接收到回复了才能再发送一个请求

### 报文结构

$HTTP$报文面向文本，因此每个字段都是一些$ASCII$码串

1. 开始行

   用于区分是**请求报文**还是**响应报文**

   请求报文开始行称为**请求行**，响应报文开始行称为**状态行**

2. 首部行

   用来说明浏览器、服务器或报文主题的一些信息，在结尾的地方要有“回车”以及“换行”

3. 实行主体

   请求报文一般不使用这个字段，响应报文也可能没有